function modalFunc(){$(".table-mk-choices").length>0&&($(".table-mk-choices").each(function(){var t=$(this).closest(".row");$(this).find("tr").each(function(){var a=$(this).closest("tr");$(this).off().on("click",function(){var e=Number(t.find(".table-mk-selected .tsks").text()),l=$(this).find("input[type=checkbox]"),i='<tr class="mk-selected" id="'+l.data("target").split("#")[1]+'">\n                      <td class="mk">'+a.find(".mk").text()+'</td>\n                      <td class="smt text-center">'+a.find(".smt").text()+'</td>\n                      <td class="sks text-center">'+a.find(".sks").text()+"</td>\n                    </tr>";l.is(":checked")?(l.prop("checked",!1),e-=Number(a.find(".sks").text()),t.find(l.data("target")).remove()):(l.prop("checked",!0),e+=Number(a.find(".sks").text()),t.find(".prepend").prepend(i)),t.find(".table-mk-selected .tsks").text(e)})})}),$("#reset-mk").off().on("click",function(){$(".tab-pane.show.active").find(".mk-choices").prop("checked",!1),$(".tab-pane.show.active").find(".mk-selected").remove(),$(".tab-pane.show.active").find(".tsks").text(0)})),$(".table-nilai").length>0&&($(".table-nilai").each(function(){$(this);$(this).find(".index").each(function(){changNilai($(this)),$(this).off().on("change",function(){changNilai($(this))})})}),$("#reset-nilai").off().on("click",function(){$(".tab-pane.show.active").find(".index").val("").trigger("change")}))}function changNilai(t){let a=Number(t.val()),e=Number(t.closest("tr").find(".sks").text()),l=a*e;t.closest("tr").find(".total").text(l),triggerNilai(_tl)}function triggerNilai(t){var a=0,e=0;t.find("tr").each(function(){e+=Number($(this).find(".sks").text())*Number(null!=$(this).find(".index").val()?$(this).find(".index").val():4),a+=Number($(this).find(".sks").text())});var l=e/a;t.find(".totalsks").text(a),t.find(".totalnilai").text(e),t.find(".ips").text(l.toFixed(2))}function formAjax(t,a=null){var e=!1;t.off().on("submit",function(l){l.preventDefault();var i=$(this),s=i.serialize(),n=i.data("url"),o=i.attr("method"),d=i.find("button[type=submit]").html();i.find("*").prop("disabled",!0),i.find("button[type=submit]").text("Silahkan tunggu ...");var r=a.html();null!=a&&a.html('<h4 class="text-center"><i class="fa fa-spinner fa-spin" aria-hidden="true"></i> Memuat data ...</h4>'),e||(e=!0,$.ajax({url:n,type:o,dataType:"json",data:s,success:function(l){e=!1,i.find("*").prop("disabled",!1),i.find("button[type=submit]").html(d),null!=l.message&&(toastr.remove(),toastr.success(l.message)),null!=l.view&&null!=a&&(a.html(l.view),formAjaxPost(t,l))},error:function(t){e=!1,toastr.remove();try{var l=JSON.parse(t.responseText),s=l.errors[Object.keys(l.errors)[0]][0];toastr.error(s)}catch(a){null!=t.responseJSON.message&&toastr.error(t.responseJSON.message)}i.find("*").prop("disabled",!1),i.find("button[type=submit]").html(d),a.html(r)}}))})}function formAjaxPost(t=null,a=null){$(".dtable").length>0&&$(".dtable").DataTable({scrollX:!0})}$(function(){var t,a={decimal:"",emptyTable:"Data tidak tersedia",info:"Menampilkan _START_ sampai _END_ dari _TOTAL_ data",infoEmpty:"Menampilkan 0 sampai 0 dari 0 data",infoFiltered:"(Difilter dari _MAX_ total data)",infoPostFix:"",thousands:",",lengthMenu:"Menampilkan _MENU_ data",loadingRecords:"Memuat...",processing:"Memproses...",search:"Cari:",zeroRecords:"Pencarian tidak ditemukan",paginate:{first:"Pertama",last:"Terakhir",next:"Selanjutnya",previous:"Sebelumnya"}},e='<div class="h4 text-center"><i class="fas fa-pulse fa-spinner"></i></div>',l='<div class="modal fade" data-backdrop="static" id="modal" aria-modal="true" role="dialog"> <div class="modal-dialog"> <div class="modal-content"> <div class="modal-header py-2"> <h4 class="modal-title"></h4> <button type="button" class="close" data-dismiss="modal" aria-label="Close"> <span aria-hidden="true">Ã—</span> </button> </div> <div class="modal-body"></div> </div> </div> </div>',i=()=>{$("#modal .modal-dialog").attr("class","modal-dialog modal-sm"),$("#modal .modal-title").html("<h5>Memuat data ...</h5>"),$("#modal .modal-body").html(e),$("#modal").modal("show")},s=(t,a=null,e=null)=>{i(),$.get(t,{},function(t){null!=e?$("#modal .modal-dialog").attr("class","modal-dialog "+e):$("#modal .modal-dialog").attr("class","modal-dialog"),$("#modal .modal-title").html(t.title),$("#modal .modal-body").html(t.form);var l=!1;$(".modal-form").off().on("submit",function(t){t.preventDefault();var e=$(this).serialize(),i=$(this),s=i.find("button[type=submit]").html();i.find("*").prop("disabled",!0),i.find("button[type=submit]").text("Silahkan tunggu ..."),l||(l=!0,$.ajax({url:i.data("url"),type:"post",dataType:"json",data:e,success:function(t){if(l=!1,toastr.remove(),toastr.success(t.message),$("#modal").modal("hide"),null!=t.redirect){var e=null!=t.timeout?t.timeout:25;setTimeout(()=>{location.href=t.redirect},e)}else null!=a&&a.ajax.reload(),i.find("*").prop("disabled",!1),i.find("button[type=submit]").html(s)},error:function(t){l=!1,toastr.remove();try{var a=JSON.parse(t.responseText),e=a.errors[Object.keys(a.errors)[0]][0];toastr.error(e)}catch(a){toastr.error(t.responseJSON.message)}i.find("*").prop("disabled",!1),i.find("button[type=submit]").html(s)}}))}),o(a),modalFunc()},"json").fail(function(t){$("#modal .modal-title").html("Kesalahan"),$("#modal .modal-body").html("Tidak dapat memuat data!")})},n=[],o=(t=null)=>{n.length>0&&(n.forEach((t,a)=>{t.select2("destroy")}),n=[]),$(".open-modal").off().on("click",function(a){a.preventDefault();let e=null!=$(this).data("type")?$(this).data("type"):null;s($(this).data("url"),t,e)}),$(".select2").length>0&&$(".select2").each(function(){var t=$(this),a=$(this).off().select2({allowClear:"false"!=t.attr("allow-clear"),placeholder:null!=$(this).data("placeholder")?$(this).data("placeholder"):"Pilih"});n.push(a)}),$(".select2-ajax").length>0&&$(".select2-ajax").each(function(){var t=$(this),a=$(this).off().select2({allowClear:"false"!=t.attr("allow-clear"),ajax:{url:t.data("url")},minimumInputLength:null!=t.data("length")?t.data("length"):1,placeholder:null!=t.data("placeholder")?t.data("placeholder"):"Pilih"});n.push(a)}),$(".datepicker").length>0&&$(".datepicker").datepicker({dateFormat:"dd-mm-yy",changeYear:!0,changeMonth:!0,yearRange:"1900:"+(new Date).getFullYear()}),$("#study-query").length>0&&formAjax($("#study-query"),$("#study-query").closest(".card").find(".card-body"))};o(t),"guest"==$("#study-query").data("role")&&$("#study-query").submit(),$("body").append(l),$(".table-list").length>0&&$(".table-list").each(function(e,l){var i=$(this).data("url"),s=$(this).data("cols").split(","),n=[];s.forEach(t=>{var a=t.split("!"),e={};e.data=a[0],e.name=a[0],null!=a[1]&&a[1].split("|").forEach(t=>{"order"==t&&(e.orderable=!1),"search"==t&&(e.searchable=!1),"visible"==t&&(e.visible=!1)}),n.push(e)}),t=$(this).DataTable({language:a,processing:!0,serverSide:!0,scrollX:!0,autoWidth:!1,ajax:null!=i?i:location.href,columns:n,drawCallback:function(a){o(t)}})})});